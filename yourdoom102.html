<!doctype html>
<html>
<head>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <meta charset="utf-8">
  <title>Project Tutorial</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f9;
      color: #222;
    }
    header {
      background: #2b7a78;
      color: white;
      padding: 20px;
      text-align: center;
    }
    section {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h2 {
      color: #2b7a78;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
      margin: 10px 0;
    }
    pre {
      background: #1e1e1e;
      color: #dcdcdc;
      padding: 12px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 14px;
    }
    iframe {
      width: 100%;
      height: 480px;
      border: none;
      border-radius: 8px;
      margin-top: 10px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      background: #def2f1;
      margin: 6px 0;
      padding: 8px;
      border-radius: 6px;
    }
    ul li a {
      color: #17252a;
      font-weight: bold;
      text-decoration: none;
    }
    ul li a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>Bote to Wifi Voucher with Thermal Printer and Server</h1>
    <p>Step-by-step guide with wiring, code, 3D model, and components list</p>
  </header>

  <section>
    <h2>üìñ Project description</h2>
    <p> The Bottle to Wi-Fi Voucher Reverse Vending Machine dispenses Wi-Fi vouchers as a reward in exchange for plastic bottles and cans, promoting recycling and waste reduction.</p> 
    <p> 
        <b>System Process:</b> 
    </p> 
    <p>The system operates when a plastic bottle is inserted into the slot. Once the laser sensor detects the object, the system verifies whether it is a valid 500 ml plastic bottle or an invalid item such as a can or organic waste using capacitive sensor. All processes are displayed on the LCD screen, including verification status, valid bottle count, voucher dispensing, and RFID access (valid or invalid) for unlocking the panel board as a safety measure. When the threshold is reached, the LCD prompts the client to redeem their reward by pressing a push button, which triggers the thermal printer to dispense a Wi-Fi voucher. Vouchers are managed through an ESP32 SoftAP mode web server, where administrators can monitor system data, upload up to a thousand voucher codes, and delete any incorrect entries.</p>
  </section>
  
   <section>
    <h2>üõí Items Needed</h2>
    <p> ‚û§ Arduino Mega</p>
    <p> ‚û§ ESP32</p>
    <p> ‚û§ 12v power supply (for Laser and capacitive sensor)</p>
    <p> ‚û§ E3F-20L Laser NPN type reciever</p>
    <p> ‚û§ E3F-20C1 Laser emitter</p>
    <p> ‚û§ MG996R Metal gear servo motor (2)</p>
    <p> ‚û§ Capacitive sensor PNP type</p>
    <p> ‚û§ RFID reader MFRC-522</p>
    <p> ‚û§ 20x4 i2c LCD</p>
    <P> ‚û§ Solenoid lock </P>
    <p> ‚û§ Thermal Printer</p>
    <p> ‚û§ 10k and 6.8k ohms resistor</p>
    <p> ‚û§ Jumper wire</p>

    <ul>
      <li><a href="https://vt.tiktok.com/ZSHWJ98H5HqRR-WTgbF/" target="_blank">Arduino Mega/ESP32/Solenoid Lock/RFID reader/ this shop is almost complete</a></li>
      <li><a href="https://vt.tiktok.com/ZSHWJxT3QH2k1-9n7VP/" target="_blank">MG996R metal gear servo motor</a></li>
      <li><a href="https://vt.tiktok.com/ZSHWJxroLn5t9-9MVdL/" target="_blank">Capacitive Sensor</a></li>
      <li><a href="https://vt.tiktok.com/ZSHn74Aa7jAWG-wdzAn/" target="_blank">Power supply</a></li>
    </ul>
  </section>

  <section>
    <h2>üìå Wiring Diagram</h2>
    <p>Follow this wiring diagram carefully:</p>
    <img src="wiring.png" alt="Wiring Diagram">
  </section>

   <section>
    <h2>‚öôÔ∏è Follow this 3d model guide</h2>
    <p>place your sesors and servo motors as shown</p>
    <img src="sensor.png" alt="sensor">
    <p>place your servo motors like this</p>
    <img src="sensor2.png" alt="sensor">
  </section>

  <section>
  <h2>üé• Project Demo Video</h2>
  <p>This is just my most basic idea of sorting mechanisim, you can use another method.</p>
  <video controls width="100%" style="border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
  <source src="demo.mp4" type="video/mp4">
</section>

<section>
  <h2>üíª Upload this code first</h2>
  <p>The servo will turn 90 degrees idle position. </p>
  <p>While in idle posotion screw your gate and sorter pad. Pads are those plain pad your servo motor is holding. </p>
  <p>In #include "<" I remove this part on all libraries since the libraries disapear as i put complete the libraries. Just put "<" and its all good. </p>

  <!-- Code container -->
  <div style="position: relative;">
    <pre id="arduinoCode">
  #include Servo.h>
  Servo servoGate,servoSorter;  
  void setup() {
  servoGate.attach(5);
  servoSorter.attach(6);
  delay(5000);
  servoGate.write(90);
  servoSorter.write(90);
  }
  void loop() {
  }
    </pre>

    <!-- Copy button -->
    <button onclick="copyCode()" 
      style="position: absolute; top: 10px; right: 10px;
             padding: 6px 12px; border: none; border-radius: 6px;
             background: #2b7a78; color: white; cursor: pointer;
             font-size: 12px; font-weight: bold;">
      Copy
    </button>
  </div>
</section>

<script>

function copyCode() {
  const code = document.getElementById("arduinoCode").innerText;
  navigator.clipboard.writeText(code).then(() => {
    alert("‚úÖ Code copied to clipboard!");
  });
}
</script>


<section>
  <h2>üíª Arduino Uno full code</h2>
   <p>In #include "<" I remove this part on all libraries since the libraries disapear as i put complete the libraries. Just put "<" and its all good. </p>
  

  <!-- Code container -->
  <div style="position: relative;">
    <pre id="arduinoCode">
#include SPI.h>
#include MFRC522.h>
#include Keypad.h>

#define RELAY_PIN 7

MFRC522 mfrc(10, 9);

const byte ROWS = 4;
const byte COLS = 4;
char keys[ROWS][COLS] = {
  {'1','2','3','A'},
  {'4','5','6','B'},
  {'7','8','9','C'},
  {'*','0','#','D'}
};
byte rowPins[ROWS] = {A0, A1, A2, A3}; 
byte colPins[COLS] = {2, 3, 4, 5};     
Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );

String pinBuffer = "";
const String PIN_CODE = "99999";

const byte TARGET_UID[] = {0xA3, 0xAA, 0x3D, 0x38};
const byte TARGET_UID_LEN = 4;

bool relayState = false; 
unsigned long lastRFIDToggle = 0;
const unsigned long RFID_DEBOUNCE_MS = 700; 

void setup() {
  Serial.begin(9600);
  SPI.begin();
  mfrc.PCD_Init();
  pinMode(RELAY_PIN, OUTPUT);
  digitalWrite(RELAY_PIN, LOW);
  Serial.println("tap mun o enter pass");
}

void loop() {
  handleRFID();
  handleKeypad();
}
void handleRFID() {
  if (!mfrc.PICC_IsNewCardPresent()) return;
  if (!mfrc.PICC_ReadCardSerial()) return;
  if (millis() - lastRFIDToggle < RFID_DEBOUNCE_MS) {
    mfrc.PICC_HaltA();
    return;
  }

  if (checkUIDMatch()) {
    Serial.println("BUBUKAS AND LOCK");
    toggleRelay();
    lastRFIDToggle = millis();
  } else {
    Serial.print("INVALID");
    printUID();
    Serial.println();
  }

  mfrc.PICC_HaltA();
  delay(200); 
}

void handleKeypad(){
  char k = keypad.getKey();
  if (!k) return;

  if (k == '#') {
    if (pinBuffer.length() > 0) {
      Serial.print("Entered PIN: "); Serial.println(pinBuffer);
      if (pinBuffer == PIN_CODE) {
        Serial.println("PIN OK BUBUKAS");
        toggleRelay();
      } else {
        Serial.println("PIN WRONG");
      }
    }
    pinBuffer = "";
  } else if (k == '*') {
    pinBuffer = "";
    Serial.println("PIN cleared");
  } else {
    if (isDigit(k) && pinBuffer.length() < 10) {
      pinBuffer += k;
      Serial.print("*"); 
    }
  }
}

void toggleRelay(){
  relayState = !relayState;
  digitalWrite(RELAY_PIN, relayState ? HIGH : LOW);
  Serial.print("Relay is now ");
  Serial.println(relayState ? "ON" : "OFF");
}

bool checkUIDMatch() {
  if (mfrc.uid.size != TARGET_UID_LEN) return false;
  for (byte i = 0; i < TARGET_UID_LEN; ++i) {
  if (mfrc.uid.uidByte[i] != TARGET_UID[i]) return false;
  }
  return true;
}

void printUID() {
  for (byte i = 0; i < mfrc.uid.size; i++) {
    byte b = mfrc.uid.uidByte[i];
    if (b < 0x10) Serial.print("0");
    Serial.print(b, HEX);
    if (i + 1 < mfrc.uid.size) Serial.print(":");
  }
}
    </pre>

    <!-- Copy button -->
    <button onclick="copyCode()" 
      style="position: absolute; top: 10px; right: 10px;
             padding: 6px 12px; border: none; border-radius: 6px;
             background: #2b7a78; color: white; cursor: pointer;
             font-size: 12px; font-weight: bold;">
      Copy
    </button>
  </div>
</section>

<script>

function copyCode() {
  const code = document.getElementById("arduinoCode").innerText;
  navigator.clipboard.writeText(code).then(() => {
    alert("‚úÖ Code copied to clipboard!");
  });
}
</script>



<section>
  <h2>üíª Arduino Mega full code</h2>
  <p>In #include "<" I remove this part on all libraries since the libraries disapear as i put complete the libraries. Just put "<" and its all good. </p>

  <!-- Code container -->
  <div style="position: relative;">
    <pre id="arduinoCode">
#include LiquidCrystal_I2C.h>
#include SPI.h>
#include Servo.h>

LiquidCrystal_I2C lcd(0x27,16,2);
#define LASER_RX_PIN 7   
#define CAP_PIN 8
#define BTN1 4
#define RELAY_PIN 5
#define SERVO1_PIN 6 //sorter
#define SERVO2_PIN 3 //gate
#define VALID_THRESHOLD 5


Servo servoGate, servoSorter;
int validCount = 0;
unsigned long laserBlockedSince = 0;
bool laserBlocked = false;

void setup(){
  Serial.begin(115200);        
  Serial1.begin(115200);      
  Serial2.begin(19200);        
  lcd.init(); lcd.backlight();
  pinMode(LASER_RX_PIN, INPUT_PULLUP); //NPN: idle HIGH
  pinMode(CAP_PIN, INPUT);
  pinMode(BTN1, INPUT_PULLUP);
  pinMode(RELAY_PIN, OUTPUT);
  digitalWrite(RELAY_PIN, LOW);
  SPI.begin();
  servoGate.attach(SERVO2_PIN);
  servoSorter.attach(SERVO1_PIN);
  servoGate.write(90); servoSorter.write(90);
  showIdle();
}

void loop(){
  if(digitalRead(LASER_RX_PIN)==LOW){ //leyser
    if(!laserBlocked){ laserBlocked = true; laserBlockedSince = millis(); 
    showIdle();
    lcd.setCursor(0,3); 
    lcd.print("     Verifing..     "); 
    }
    else if(millis() - laserBlockedSince >= 3000){
      if(digitalRead(CAP_PIN)==LOW){ // plastic = VALID
        validCount++;
        lcd.clear(); 
        lcd.setCursor(0,1); 
        lcd.print("Valid Input"); 
        lcd.setCursor(0,2); 
        lcd.print("Thank You!");
        delay(1000);
        showIdle();
        valid();
        Serial1.println("LOG:VALID"); // log to ESP32

        if(validCount >= VALID_THRESHOLD) 
        
        lcd.clear(); 
        lcd.setCursor(0,1); 
        lcd.print("  Press PushButton  "); 
        lcd.setCursor(0,2); 
        lcd.print("  Enjoy ur voucher  ");

      } else {
        lcd.clear(); 
        lcd.setCursor(0,1); 
        lcd.print("   Invalid Input    "); 
        lcd.setCursor(0,2); 
        lcd.print(" Sorry, try again!  ");
        delay(1000);
        invalid();
      }
      delay(800);
      laserBlocked = false;
      waitForLaserClear();
    }
  } 
  else {
    laserBlocked = false;
  }

  if(digitalRead(BTN1) == LOW){ 
    if(validCount >= VALID_THRESHOLD){
      Serial1.println("GET_VOUCHER");
      String resp = readSerial1Line(3000);
      if(resp.startsWith("VOUCHER:")){
        String v = resp.substring(8);
        printVoucher(v); // send to Serial2
        Serial1.println("VOUCHER_USED:" + v);
        validCount = 0;


        lcd.clear(); 
        lcd.setCursor(0,1); 
        lcd.print("   Voucher Printed   "); }
        lcd.setCursor(0,2); 
        lcd.print("  Enjoy ur voucher!  ");
        delay(1000);


      }
    }
    delay(500);
  }

void printVoucher(String v){
  Serial2.println(v); 
}
String readSerial1Line(unsigned long timeout){
  unsigned long t0=millis(); String s="";
  while(millis()-t0 < timeout){
    if(Serial1.available()){ char c=Serial1.read(); if(c=='\n') break; s+=c;}
  }
  return s;
}

void showIdle()
{ 
  lcd.clear(); 
  lcd.setCursor(0,0); 
  lcd.print("     Bote Wifi      "); 
  lcd.setCursor(0,1); 
  lcd.print("Insert valid bottle "); 
  lcd.setCursor(0,2); 
  lcd.print("Count:"+String(validCount));
  }

void waitForLaserClear(){ while(digitalRead(LASER_RX_PIN)==LOW) delay(50); }

void valid(){
  servoGate.write(90); servoSorter.write(90);
  delay(200);
  servoGate.write(90); servoSorter.write(10);
  delay(2000);
  servoGate.write(160); servoSorter.write(10);
  delay(3000);
  servoGate.write(90); servoSorter.write(90);
  delay(200);
}

void invalid(){
  servoGate.write(90); servoSorter.write(90);
  delay(200);
  servoGate.write(90); servoSorter.write(160);
  delay(2000);
  servoGate.write(160); servoSorter.write(160);
  delay(3000);
   servoGate.write(90); servoSorter.write(90);
  delay(200);
}
    </pre>

    <!-- Copy button -->
    <button onclick="copyCode()" 
      style="position: absolute; top: 10px; right: 10px;
             padding: 6px 12px; border: none; border-radius: 6px;
             background: #2b7a78; color: white; cursor: pointer;
             font-size: 12px; font-weight: bold;">
      Copy
    </button>
  </div>
</section>

<script>

function copyCode() {
  const code = document.getElementById("arduinoCode").innerText;
  navigator.clipboard.writeText(code).then(() => {
    alert("‚úÖ Code copied to clipboard!");
  });
}
</script>




<section>
  <h2>üíª ESP32 WROOM N16R8 Code</h2>
  <p>You can download the full ESP32 code here:</p>
  
  <a href="https://drive.google.com/file/d/1-7-xT1wx293bdNCghLFfHk9eHRCpJNsX/view?usp=drive_link" 
     target="_blank" 
     style="display:inline-block; padding:10px 15px; background:#2b7a78; color:white; border-radius:8px; text-decoration:none; font-weight:bold;">
    üì• Download ESP32 Code
  </a>
</section>

    <section>
    <h2>üìå Server Preview</h2>
    <img src="ss2.png" alt="ss1">
  </section>

  <section>
  <h2>üìê 3D Model</h2>
  <p>You can rotate and zoom in on the 3D design below:</p>
  <model-viewer src="model1.glb" alt="3D Prototype"
  auto-rotate camera-controls style="width:100%; height:480px;">
</model-viewer>
</section>

</body>
</html>




